<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Vault App</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#175DDC">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --primary: #175DDC; --bg: #f2f4f8; --text: #333; --danger: #e74c3c; --success: #27ae60; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--bg); margin: 0; padding-top: 80px; padding-bottom: 100px; -webkit-tap-highlight-color: transparent; user-select: none; }
        
        /* HEADER APP STYLE */
        .header { background: var(--primary); padding: 15px; position: fixed; top: 0; left: 0; right: 0; z-index: 1000; box-shadow: 0 2px 10px rgba(0,0,0,0.2); }
        .search-container { position: relative; width: 100%; }
        .search-box { width: 100%; padding: 12px 15px 12px 45px; border-radius: 25px; border: none; font-size: 16px; background: rgba(255,255,255,0.2); color: white; outline: none; box-sizing: border-box; backdrop-filter: blur(5px); }
        .search-box::placeholder { color: rgba(255,255,255,0.7); }
        .search-icon { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: rgba(255,255,255,0.7); }

        /* LIST CARD */
        .container { padding: 10px 15px; }
        .card { background: white; border-radius: 16px; padding: 16px; margin-bottom: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.03); border: 1px solid #fff; transition: transform 0.1s; }
        .card:active { transform: scale(0.98); }
        
        /* Header Card: Logo + Name + Actions */
        .card-top { display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #f0f0f0; }
        .card-brand { display: flex; align-items: center; gap: 12px; flex: 1; overflow: hidden; }
        .brand-logo { width: 32px; height: 32px; border-radius: 8px; object-fit: contain; background: #fff; }
        .brand-name { font-weight: 700; font-size: 17px; color: #2c3e50; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        
        /* Action Buttons (Edit/Delete) */
        .card-actions { display: flex; gap: 15px; }
        .icon-btn { color: #95a5a6; font-size: 18px; cursor: pointer; padding: 5px; }
        .icon-btn.edit:hover { color: var(--primary); }
        .icon-btn.del { color: #ff6b6b; }

        /* Data Rows */
        .data-row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; background: #f8f9fa; padding: 8px 12px; border-radius: 8px; }
        .data-content { flex: 1; overflow: hidden; margin-right: 10px; }
        .data-label { font-size: 11px; color: #999; text-transform: uppercase; margin-bottom: 2px; }
        .data-value { font-size: 14px; font-family: 'Courier New', monospace; color: #333; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-weight: 600; }
        
        /* Copy Button */
        .copy-btn { background: white; border: 1px solid #ddd; color: var(--primary); font-weight: 700; font-size: 12px; padding: 6px 12px; border-radius: 6px; min-width: 60px; text-align: center; transition: all 0.2s; cursor: pointer; }
        .copy-btn.copied { background: var(--success); color: white; border-color: var(--success); }

        /* Link Row */
        .link-row { margin-top: 5px; text-align: right; }
        .website-link { font-size: 13px; color: var(--primary); text-decoration: none; font-weight: 500; display: inline-flex; align-items: center; gap: 5px; padding: 5px 0; }
        
        /* FAB Add Button */
        .fab { position: fixed; bottom: 30px; right: 30px; width: 60px; height: 60px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 24px; box-shadow: 0 10px 20px rgba(23, 93, 220, 0.4); z-index: 200; cursor: pointer; }

        /* MODAL */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 10000; align-items: center; justify-content: center; backdrop-filter: blur(3px); }
        .modal-content { background: white; width: 85%; border-radius: 20px; padding: 25px; box-shadow: 0 20px 50px rgba(0,0,0,0.2); animation: popIn 0.2s; }
        .inp-group { margin-bottom: 15px; }
        .inp-group label { font-size: 13px; color: #666; font-weight: 600; margin-bottom: 5px; display: block; }
        .inp { width: 100%; padding: 12px; border: 1px solid #eee; background: #f9f9f9; border-radius: 10px; font-size: 16px; outline: none; box-sizing: border-box; }
        .inp:focus { border-color: var(--primary); background: white; }
        .btn-row { display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px; }
        .btn { padding: 12px 24px; border-radius: 10px; border: none; font-weight: 600; font-size: 15px; }
        .btn-close { background: #f0f0f0; color: #555; }
        .btn-save { background: var(--primary); color: white; }

        @keyframes popIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    </style>
</head>
<body>

    <div class="header">
        <div class="search-container">
            <i class="fas fa-search search-icon"></i>
            <input type="text" id="search" class="search-box" placeholder="Tìm kiếm tài khoản..." oninput="render()">
        </div>
    </div>

    <div class="container" id="list"></div>

    <div class="fab" onclick="openModal()"><i class="fas fa-plus"></i></div>

    <div class="modal" id="modal">
        <div class="modal-content">
            <h2 style="margin-top:0; color:var(--primary)">Tài khoản</h2>
            <input type="hidden" id="editId">
            
            <div class="inp-group">
                <label>Website (Để tự lấy Logo)</label>
                <input type="text" id="inpWeb" class="inp" placeholder="Ví dụ: facebook.com" onblur="autoFillName()">
            </div>
            <div class="inp-group">
                <label>Tên gợi nhớ</label>
                <input type="text" id="inpName" class="inp" placeholder="Facebook">
            </div>
            <div class="inp-group">
                <label>Tên đăng nhập</label>
                <input type="text" id="inpUser" class="inp">
            </div>
            <div class="inp-group">
                <label>Mật khẩu</label>
                <input type="text" id="inpPass" class="inp">
            </div>

            <div class="btn-row">
                <button class="btn btn-close" onclick="closeModal()">Hủy</button>
                <button class="btn btn-save" onclick="saveData()">Lưu</button>
            </div>
        </div>
    </div>

    <script>
        let vault = JSON.parse(localStorage.getItem('vault_v4')) || [
            { id: 1, name: "Google", user: "example@gmail.com", pass: "Pass123", web: "https://google.com" },
            { id: 2, name: "Facebook", user: "user.fb", pass: "Fb@2026", web: "https://facebook.com" }
        ];

        // LOGIC LẤY LOGO
        function getFavicon(url) {
            if (!url) return 'https://cdn-icons-png.flaticon.com/512/2889/2889676.png';
            let domain = url.replace('https://', '').replace('http://', '').split('/')[0];
            return `https://www.google.com/s2/favicons?domain=${domain}&sz=128`;
        }

        // TỰ ĐIỀN TÊN KHI NHẬP WEB
        function autoFillName() {
            const web = document.getElementById('inpWeb').value;
            const name = document.getElementById('inpName');
            if (web && !name.value) {
                let domain = web.replace('https://', '').replace('http://', '').split('/')[0].replace('www.', '');
                name.value = domain.split('.')[0].charAt(0).toUpperCase() + domain.split('.')[0].slice(1);
            }
        }

        function render() {
            const q = document.getElementById('search').value.toLowerCase();
            const list = document.getElementById('list');
            list.innerHTML = '';

            vault.filter(i => i.name.toLowerCase().includes(q) || i.web.toLowerCase().includes(q)).forEach(item => {
                // Xử lý link web
                let fullLink = item.web.startsWith('http') ? item.web : 'https://' + item.web;
                
                list.innerHTML += `
                    <div class="card">
                        <div class="card-top">
                            <div class="card-brand">
                                <img src="${getFavicon(item.web)}" class="brand-logo" onerror="this.src='https://cdn-icons-png.flaticon.com/512/1000/1000997.png'">
                                <span class="brand-name">${item.name}</span>
                            </div>
                            <div class="card-actions">
                                <i class="fas fa-pen icon-btn edit" onclick="openModal(${item.id})"></i>
                                <i class="fas fa-trash icon-btn del" onclick="deleteItem(${item.id})"></i>
                            </div>
                        </div>

                        <div class="data-row">
                            <div class="data-content">
                                <div class="data-label">Username</div>
                                <div class="data-value">${item.user}</div>
                            </div>
                            <button class="copy-btn" onclick="copy(this, '${item.user}')">COPY</button>
                        </div>

                        <div class="data-row">
                            <div class="data-content">
                                <div class="data-label">Password</div>
                                <div class="data-value">••••••••</div>
                            </div>
                             <i class="fas fa-eye" style="color:#aaa; padding:10px; cursor:pointer" onclick="togglePass(this, '${item.pass}')"></i>
                            <button class="copy-btn" onclick="copy(this, '${item.pass}')">COPY</button>
                        </div>

                        <div class="link-row">
                            <a href="${fullLink}" target="_blank" class="website-link">
                                Truy cập Website <i class="fas fa-external-link-alt"></i>
                            </a>
                        </div>
                    </div>
                `;
            });
        }

        function togglePass(icon, pass) {
            const valueDiv = icon.previousElementSibling.querySelector('.data-value');
            if(valueDiv.innerText === '••••••••') {
                valueDiv.innerText = pass;
                icon.className = "fas fa-eye-slash";
                icon.style.color = "var(--primary)";
            } else {
                valueDiv.innerText = '••••••••';
                icon.className = "fas fa-eye";
                icon.style.color = "#aaa";
            }
        }

        function copy(btn, text) {
            navigator.clipboard.writeText(text);
            const originalText = btn.innerText;
            
            // Đổi giao diện nút
            btn.innerText = "ĐÃ CHÉP";
            btn.classList.add('copied');
            
            if(navigator.vibrate) navigator.vibrate(50);

            setTimeout(() => {
                btn.innerText = originalText;
                btn.classList.remove('copied');
            }, 1500);
        }

        // CRUD LOGIC
        function openModal(id = null) {
            document.getElementById('modal').style.display = 'flex';
            document.getElementById('inpWeb').value = '';
            document.getElementById('inpName').value = '';
            document.getElementById('inpUser').value = '';
            document.getElementById('inpPass').value = '';
            document.getElementById('editId').value = '';

            if (id) {
                const item = vault.find(i => i.id === id);
                document.getElementById('editId').value = id;
                document.getElementById('inpWeb').value = item.web;
                document.getElementById('inpName').value = item.name;
                document.getElementById('inpUser').value = item.user;
                document.getElementById('inpPass').value = item.pass;
            }
        }

        function closeModal() { document.getElementById('modal').style.display = 'none'; }

        function saveData() {
            const id = document.getElementById('editId').value;
            const data = {
                id: id ? Number(id) : Date.now(),
                web: document.getElementById('inpWeb').value,
                name: document.getElementById('inpName').value,
                user: document.getElementById('inpUser').value,
                pass: document.getElementById('inpPass').value
            };

            if (!data.name || !data.pass) return alert("Cần nhập tên và mật khẩu");

            if (id) {
                const idx = vault.findIndex(i => i.id == id);
                vault[idx] = data;
            } else {
                vault.unshift(data); // Thêm lên đầu
            }
            
            localStorage.setItem('vault_v4', JSON.stringify(vault));
            closeModal();
            render();
        }

        function deleteItem(id) {
            if(confirm('Xóa tài khoản này?')) {
                vault = vault.filter(i => i.id !== id);
                localStorage.setItem('vault_v4', JSON.stringify(vault));
                render();
            }
        }

        render();
        // Service Worker Reg
        if('serviceWorker' in navigator) navigator.serviceWorker.register('sw.js');
    </script>
</body>
</html>
