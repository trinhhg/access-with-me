<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Vault</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#175DDC">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --bw-blue: #175DDC; --bg: #f4f4f4; --text: #333; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--bg); margin: 0; padding-top: 140px; padding-bottom: 80px; -webkit-tap-highlight-color: transparent; }
        
        /* HEADER */
        .header { background: var(--bw-blue); padding: 15px; position: fixed; top: 0; width: 100%; z-index: 100; box-sizing: border-box; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .logo-area { display: flex; align-items: center; color: white; font-weight: bold; font-size: 20px; }
        .logo-img { width: 30px; height: 30px; margin-right: 10px; }
        
        /* SEARCH & FILTER */
        .search-box { width: 100%; padding: 12px 15px; border-radius: 8px; border: none; font-size: 16px; outline: none; background: white; box-sizing: border-box; }
        
        /* LIST */
        .container { padding: 15px; }
        .card { background: white; border-radius: 10px; padding: 15px; margin-bottom: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); position: relative; }
        .card-header { display: flex; align-items: center; margin-bottom: 15px; }
        .app-icon { width: 40px; height: 40px; background: #eee; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 20px; color: #555; margin-right: 15px; }
        .app-name { font-size: 17px; font-weight: 600; flex-grow: 1; }
        .edit-btn { color: #888; background: none; border: none; padding: 5px; cursor: pointer; }

        /* FIELD ROWS */
        .row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; }
        .row:last-child { margin-bottom: 0; }
        .label { font-size: 12px; color: #666; width: 60px; }
        .value-box { background: #f8f9fa; padding: 8px 12px; border-radius: 6px; flex-grow: 1; margin-right: 10px; font-family: monospace; font-size: 14px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; display: flex; align-items: center; justify-content: space-between;}
        .action-btn { background: none; border: none; color: var(--bw-blue); font-weight: 600; font-size: 13px; cursor: pointer; }
        
        /* FAB BUTTON (Add New) */
        .fab { position: fixed; bottom: 25px; right: 25px; background: var(--bw-blue); width: 56px; height: 56px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 24px; box-shadow: 0 4px 15px rgba(23, 93, 220, 0.4); cursor: pointer; z-index: 200; }

        /* MODAL (Add/Edit) */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 300; align-items: center; justify-content: center; }
        .modal-content { background: white; width: 90%; max-width: 400px; border-radius: 12px; padding: 20px; box-sizing: border-box; animation: slideUp 0.3s; }
        .modal h2 { margin-top: 0; color: var(--bw-blue); }
        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; margin-bottom: 5px; font-size: 14px; color: #555; }
        .input-group input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; font-size: 16px; }
        .modal-actions { display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px; }
        .btn { padding: 10px 20px; border-radius: 6px; border: none; font-size: 15px; cursor: pointer; }
        .btn-cancel { background: #eee; color: #333; }
        .btn-save { background: var(--bw-blue); color: white; }
        .btn-delete { background: #ff3b30; color: white; margin-right: auto; }

        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    </style>
</head>
<body>

    <div class="header">
        <div class="top-bar">
            <div class="logo-area">
                <svg class="logo-img" viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M25 0C11.1929 0 0 11.1929 0 25C0 38.8071 11.1929 50 25 50C38.8071 50 50 38.8071 50 25C50 11.1929 38.8071 0 25 0ZM39.6 30.6C39.6 30.6 35.5 35.8 25 35.8C14.5 35.8 10.4 30.6 10.4 30.6C9.6 29.6 9.8 28.2 10.8 27.5C11.7 26.8 13.1 26.9 13.9 27.9C13.9 27.9 16.6 31.4 25 31.4C33.4 31.4 36.1 27.9 36.1 27.9C36.9 26.9 38.3 26.8 39.2 27.5C40.2 28.2 40.3 29.6 39.6 30.6ZM25 21.4C19.8 21.4 15.6 17.2 15.6 12.1C15.6 11.2 16.3 10.5 17.2 10.5C18.1 10.5 18.8 11.2 18.8 12.1C18.8 15.5 21.5 18.2 25 18.2C28.5 18.2 31.2 15.5 31.2 12.1C31.2 11.2 31.9 10.5 32.8 10.5C33.7 10.5 34.4 11.2 34.4 12.1C34.4 17.2 30.2 21.4 25 21.4Z" fill="white"/>
                </svg>
                Kho Bảo Mật
            </div>
            <i class="fas fa-sync" style="color:white; opacity:0.7" onclick="location.reload()"></i>
        </div>
        <input type="text" id="search" class="search-box" placeholder="Tìm kiếm tài khoản..." oninput="render()">
    </div>

    <div class="container" id="list"></div>

    <div class="fab" onclick="openModal()"><i class="fas fa-plus"></i></div>

    <div class="modal" id="modal">
        <div class="modal-content">
            <h2 id="modalTitle">Thêm Tài Khoản</h2>
            <input type="hidden" id="editId">
            <div class="input-group">
                <label>Tên dịch vụ</label>
                <input type="text" id="inpName" placeholder="Ví dụ: Facebook">
            </div>
            <div class="input-group">
                <label>Tên đăng nhập / Email</label>
                <input type="text" id="inpUser" placeholder="email@example.com">
            </div>
            <div class="input-group">
                <label>Mật khẩu</label>
                <div style="position:relative">
                    <input type="text" id="inpPass" placeholder="Nhập mật khẩu">
                </div>
            </div>
            <div class="input-group">
                <label>Website</label>
                <input type="text" id="inpWeb" placeholder="https://...">
            </div>
            <div class="modal-actions">
                <button class="btn btn-delete" id="btnDelete" onclick="deleteItem()" style="display:none">Xóa</button>
                <button class="btn btn-cancel" onclick="closeModal()">Hủy</button>
                <button class="btn btn-save" onclick="saveItem()">Lưu</button>
            </div>
        </div>
    </div>

    <script>
        // Dữ liệu mẫu ban đầu (chỉ dùng khi chưa có gì)
        const defaultData = [
            { id: 1700000000000, name: "Facebook", user: "my.email@gmail.com", pass: "MatKhau123", web: "facebook.com" },
            { id: 1700000000001, name: "Google", user: "student@edu.vn", pass: "HSK5_2026", web: "google.com" }
        ];

        let vault = [];

        // 1. Tải dữ liệu từ LocalStorage
        function loadVault() {
            const stored = localStorage.getItem('myVaultData');
            if (stored) {
                vault = JSON.parse(stored);
            } else {
                vault = defaultData;
                saveVault(); // Lưu mẫu vào luôn
            }
            render();
        }

        // 2. Lưu dữ liệu
        function saveVault() {
            localStorage.setItem('myVaultData', JSON.stringify(vault));
            render();
        }

        // 3. Render ra màn hình
        function render() {
            const query = document.getElementById('search').value.toLowerCase();
            const list = document.getElementById('list');
            list.innerHTML = '';

            const filtered = vault.filter(i => 
                i.name.toLowerCase().includes(query) || i.user.toLowerCase().includes(query)
            );

            if (filtered.length === 0) {
                list.innerHTML = '<div style="text-align:center; color:#999; margin-top:50px">Không tìm thấy dữ liệu</div>';
                return;
            }

            // Sắp xếp mới nhất lên đầu
            filtered.sort((a,b) => b.id - a.id).forEach(item => {
                list.innerHTML += `
                    <div class="card">
                        <div class="card-header">
                            <div class="app-icon">${item.name.charAt(0).toUpperCase()}</div>
                            <span class="app-name">${item.name}</span>
                            <button class="edit-btn" onclick="openModal(${item.id})"><i class="fas fa-pen"></i></button>
                        </div>
                        
                        <div class="row">
                            <span class="label">User</span>
                            <div class="value-box">${item.user}</div>
                            <button class="action-btn" onclick="copy('${item.user}')">COPY</button>
                        </div>

                        <div class="row">
                            <span class="label">Pass</span>
                            <div class="value-box">
                                <span id="pass-txt-${item.id}">••••••••</span>
                                <i class="fas fa-eye" style="color:#aaa; cursor:pointer" onclick="toggleVis('${item.id}', '${item.pass}')"></i>
                            </div>
                            <button class="action-btn" onclick="copy('${item.pass}')">COPY</button>
                        </div>
                    </div>`;
            });
        }

        // 4. Các hàm tiện ích
        function toggleVis(id, pass) {
            const el = document.getElementById(`pass-txt-${id}`);
            if (el.innerText === '••••••••') {
                el.innerText = pass;
            } else {
                el.innerText = '••••••••';
            }
        }

        function copy(text) {
            navigator.clipboard.writeText(text);
            // Hiệu ứng rung nhẹ
            if (navigator.vibrate) navigator.vibrate(30);
            alert("Đã sao chép: " + text);
        }

        // 5. Xử lý Modal (Thêm/Sửa)
        function openModal(id = null) {
            const modal = document.getElementById('modal');
            const title = document.getElementById('modalTitle');
            const btnDel = document.getElementById('btnDelete');
            
            // Reset form
            document.getElementById('inpName').value = '';
            document.getElementById('inpUser').value = '';
            document.getElementById('inpPass').value = '';
            document.getElementById('inpWeb').value = '';
            document.getElementById('editId').value = '';

            if (id) {
                // Chế độ Sửa
                const item = vault.find(i => i.id === id);
                if (item) {
                    title.innerText = 'Chỉnh sửa';
                    document.getElementById('editId').value = item.id;
                    document.getElementById('inpName').value = item.name;
                    document.getElementById('inpUser').value = item.user;
                    document.getElementById('inpPass').value = item.pass;
                    document.getElementById('inpWeb').value = item.web;
                    btnDel.style.display = 'block';
                }
            } else {
                // Chế độ Thêm mới
                title.innerText = 'Thêm mới';
                btnDel.style.display = 'none';
            }
            modal.style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('modal').style.display = 'none';
        }

        function saveItem() {
            const id = document.getElementById('editId').value;
            const name = document.getElementById('inpName').value;
            const user = document.getElementById('inpUser').value;
            const pass = document.getElementById('inpPass').value;
            const web = document.getElementById('inpWeb').value;

            if(!name || !pass) { alert("Vui lòng nhập tên và mật khẩu!"); return; }

            if (id) {
                // Sửa
                const index = vault.findIndex(i => i.id == id);
                if (index !== -1) {
                    vault[index] = { id: parseInt(id), name, user, pass, web };
                }
            } else {
                // Thêm mới (Dùng ID theo thời gian để không trùng)
                vault.push({ id: Date.now(), name, user, pass, web });
            }

            saveVault();
            closeModal();
        }

        function deleteItem() {
            if(confirm("Bạn chắc chắn muốn xóa?")) {
                const id = document.getElementById('editId').value;
                vault = vault.filter(i => i.id != id);
                saveVault();
                closeModal();
            }
        }

        // Khởi chạy
        loadVault();
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js');
        }
    </script>
</body>
</html>
